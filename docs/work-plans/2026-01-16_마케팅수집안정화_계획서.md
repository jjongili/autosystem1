# 마케팅 수집 안정화 구현 계획 (지시서 반영)

지시서(`2026-01-16_프로젝트현황_안티그래비티지시서.md`)의 가이드를 준수하여 크롬 충돌 문제를 해결하고 수집 프로세스의 안정성을 고도화합니다.

## 주요 변경 사항

### 1. Chrome 연결 안정화 (별도 전용 프로필 사용)
- **문제**: 기존 크롬 세션과의 프로필 중복 점유로 인한 `session not created` 오류.
- **해결 (지시서 방법 3)**: 마케팅 수집 전용 크롬 프로필(`marketing_chrome_profile`)을 사용하여 독립적인 환경을 구축합니다.
- **대상 파일**: [marketing_collector.py](file:///C:/Users/jjong.PCONOMI/OneDrive/autosystem1/web_system/modules/marketing_collector.py)

### 2. 비즈어드바이저 iframe 전환 로직 안정화
- **문제**: iframe 구조 변경 또는 로딩 지연으로 인한 수집 불안정.
- **해결**: 지시서 가이드에 따라 iframe 진입 전 대기 시간을 확보하고, 타겟 iframe(`iframe#__delegate` 등) 탐색 로직을 정밀하게 보강합니다.

### 3. 로그인 및 2차 인증 최종 정제
- **검증**: ID/PW 입력, Enter 키 제출, SMS 수신 및 자동 입력이 지연 없이 수행되는지 재검증합니다.
- **방침**: 부작용이 우려되는 강제 이동 전략을 배제하고, `client_v1.5.py` 기반의 안정적인 버튼 탐색을 유지합니다.

## 작업 상세

### [MODIFY] [marketing_collector.py](file:///C:/Users/jjong.PCONOMI/OneDrive/autosystem1/web_system/modules/marketing_collector.py)
- **`connect_chrome`**: 프로필 경로를 `runtime/marketing_chrome_profile`로 고정하여 충돌 원천 차단.
- **`collect_marketing_data`**: 비즈어드바이저 iframe 전환 실패 시 재시도 로직 및 상세 로그 추가.

## 검증 계획
### 단독 테스트
- `python -m modules.marketing_collector` 실행을 통해 전체 수집 프로세스(로그인~저장)를 확인합니다.

### 체크리스트 (지시서 기반)
- [ ] 전용 프로필 사용 시 기존 크롬 실행 여부와 무관하게 브라우저가 뜨는지 확인
- [ ] ID/PW 입력 및 Enter 키 로그인 동작 확인
- [ ] SMS 인증번호 자동 입력 및 팝업 자동 처리 확인
- [ ] 비즈어드바이저 및 쇼핑파트너센터 데이터 수집 여부 확인

> [!IMPORTANT]
> 프로그램이 알아서 환경 충돌을 피하고 데이터를 안정적으로 가져오는 데 집중하겠습니다.
