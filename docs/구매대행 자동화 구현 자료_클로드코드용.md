# 구매대행 교육 자료 분석 및 자동화 적용 가이드
## 📌 클로드코드 작업용 문서

---

## 🔷 현재 시스템 구현 현황 (2026.01.15 기준)

### ✅ 이미 구현 완료된 기능

#### 1. 핵심 인프라
- FastAPI 웹서버 (server.py)
- Google Sheets API 연동 (계정/설정 관리)
- 로그인/권한 시스템 (admin/operator/viewer)
- WebSocket 실시간 통신
- Chrome Extension 자동 로그인 + Client 프로그램

#### 2. 계정 관리 시스템
- 관제센터 (100개+ 스마트스토어 계정 통합 모니터링)
- 계정 상태 자동 감지 (정상/주의/경고/정지)
- 필터링 (소유자/용도/상태/매출/주문 계급)

#### 3. SMS 자동화
- Google Messages Web 연동
- 인증번호 자동 추출/입력
- SMS 전송/수신/대화 관리
- 3개 폰 번호 관리

#### 4. 매출 관리
- 일일 매출 장부 (Google Sheets 자동 기록)
- TOP 40 상품 분석
- 소유자별/용도별 매출 집계
- 사업자번호별 매출 (부가세 신고용)
- 플랫폼별 통계

#### 5. 올인원 자동화 (All-in-One)
- 등록갯수 조회
- 배송코드 조회/배송변경 (대량 일괄)
- 상품삭제 (오래된 상품)
- 혜택설정 (쿠폰/리뷰포인트)
- 중복삭제
- KC인증 제외 설정
- 병렬 처리 (4개 워커)

#### 6. 스케줄러
- Cron 기반 자동 실행
- 올인원 작업 예약
- 실행 로그 기록

#### 7. 불사자 연동
- 2개 시스템 연동 (반대량프리미엄 1, 2)
- 상품 복사 (타이틀 메이커+)
- Claude/Gemini API 활용 상품명 생성

#### 8. 마케팅 분석 (🔄 진행 중)
- marketing_collector.py 모듈 개발 중
- 데이터 수집 위치 2곳:
  1. **비즈어드바이저** - 상품노출성과 (노출순위/유입수)
  2. **쇼핑파트너센터** - 상품클릭리포트 (클릭수/전환수/판매액)
- SMS 2차 인증 자동 처리 (server API 연동)
- 상품별 탭 데이터 수집
- Google Sheets 저장 구조 설계 완료

---

## 🔷 교육 자료 핵심 요약

### 1. 실전 노하우 (중요!)
| 핵심 내용 | 자동화 적용 포인트 |
|----------|-------------------|
| **노출 로직** | 적합도(상품명>브랜드>카테고리) + 인기도(클릭/판매/최신성/리뷰) + 신뢰도 |
| **쿠폰 타이밍** | 신상품 직후, 물갈이 후, 광고 집행 전, 재고 정리 시 |
| **찜 = 재노출 자산** | 찜 유도 문구 + 찜 전용 쿠폰 |
| **물갈이 주기** | 평균 2개월, 유입수 추세 기반 즉시 대응 |
| **물갈이 신호** | 주간 유입량 20-30% 감소, 클릭률 1% 이하, 조회수 하락 |
| **클린위반 관리** | 주차별 누적(월~일), 24주 이력 유지, 이번 주 내 처리 필수 |
| **반대량→반자동 가공** | 풀 확보 후 성과 좋은 상품만 키워드/가격/상세 최적화 |

### 4. 광고 설정 가이드
- 네이버 쇼핑검색 광고 세팅
- 그룹당 상품 1,000개 제한 → 10개 그룹 복사로 확장
- 요일/시간대 선택 가능

---

## 🔷 신규 구현 필요 기능 (우선순위별)

### 🔴 Phase 1: 마케팅 데이터 활용 (현재 진행 중 완성)

#### 1.1 마케팅분석 데이터 수집 완성
```
현재 상태: marketing_collector.py 개발 중
수집 데이터:
├── 비즈어드바이저
│   └── 상품노출성과 (상품별 평균노출순위, 유입수)
└── 쇼핑파트너센터
    └── 상품클릭리포트 - 상품별 탭
        └── 상품번호, 상품명, 노출수, 클릭수, 클릭률, CPC수수료

저장: Google Sheets (마케팅 전용 시트)
```

#### 1.2 물갈이 알림 시스템 (신규)
```python
# 물갈이 대상 판단 로직 (교육자료 기반)
def check_product_refresh_needed(product_data):
    """
    조건:
    1. 등록일 기준 60일 이상 경과
    2. 주간 유입수 20% 이상 감소
    3. 클릭률 1% 이하 지속
    4. 최근 7일 판매 0건
    
    ※ 리뷰 있는 상품은 별도 관리 (물갈이 제외)
    """
    
    # 반환: 물갈이 필요 상품 리스트 + 사유
```

#### 1.3 상품 성과 대시보드 (신규)
```
표시 항목:
├── 상품별 유입수/클릭수/전환수 추이 (7일/30일)
├── 물갈이 필요 상품 리스트 (조건별 필터)
├── 효자상품 TOP 20 (전환율 기준)
└── 광고 효율 저하 상품 (클릭 있으나 전환 없음)
```

---

### 🟡 Phase 2: 쿠폰/찜/혜택 자동화

#### 2.1 쿠폰 자동 발급 (교육자료 기반)
```python
# 쿠폰 발급 타이밍
COUPON_TRIGGERS = {
    "신상품_업로드": "등록 직후",
    "물갈이_재업로드": "재등록 직후", 
    "광고_집행_전": "광고 시작 1일 전",
    "재고_정리": "수동 트리거"
}

# 쿠폰 설정 기준
COUPON_SETTINGS = {
    "할인율": "5-7%",  # 3%는 체감 미미, 10% 이상은 마진 붕괴
    "금액_기준": {
        "소액상품": 1000,
        "중저가": 3000,
        "중가": 5000,
        "고가": 7000
    }
}
```

#### 2.2 찜 유도 자동화
- 상세페이지 상단 찜 유도 문구 자동 삽입
- 찜 전용 쿠폰 자동 연동

---

### 🟡 Phase 3: 클린위반 관리

#### 3.1 클린위반 모니터링 (신규)
```python
# 수집 위치: 쇼핑파트너센터 > 정보관리 > 클린위반현황
# 수집 주기: 매일 1회

# 위반 유형 (교육자료 기반)
CLEAN_VIOLATION_TYPES = {
    "취급불가상품": "가슴패치, 살충제, 의료기기 표현",
    "상품명표기기준": "모음전, 가격어뷰징",
    "가격옵션배송비어뷰징": "실제보다 싸 보이게",
    "중복상품": "키워드만 바꿔 중복 등록",
    "상품정보불일치": "소재/사이즈/옵션 불일치",
    "허위과장문구": "100% 효과, 의사추천",
    "지재권침해": "브랜드/캐릭터/연예인",
    "해외구매대행고지미흡": "배송기간/관부가세/반품조건"
}

# 알림 조건
- 위반 발생 즉시 → 카카오톡/SMS 알림
- 주차별 누적 현황 → 일일 리포트
- 처리 기한 임박 → 긴급 알림
```

#### 3.2 클린위반 자동 검수 (상품 등록 전)
```python
# 등록 전 자동 필터링
PRE_UPLOAD_CHECKS = {
    "금지키워드": ["100%효과", "완치", "의사추천", "1위", "베스트"],
    "브랜드명": ["나이키", "샤넬", "디즈니", ...],  # 기존 필터 활용
    "가격구조": "대표상품 옵션추가금 0원 확인",
    "해외구매대행고지": "고지문구 포함 여부"
}
```

---

### 🟢 Phase 4: 자동 삭제/재업로드 시스템

#### 4.1 물갈이/리뉴얼 대상 조건
```python
# 물갈이 대상 조건 (OR - 하나라도 해당되면 대상)
REFRESH_CONDITIONS = {
    "조건1": "등록 7일 이상 AND 5일 연속 유입 감소 AND 5일 연속 주문 0건",
    "조건2": "최근 30일 매출 50만원 이하",
    "조건3": "운영일 60일 경과"
}

# 보호 조건 (OR - 하나라도 해당되면 물갈이 제외)
# ※ 위 3가지 조건 모두에 공통 적용
EXCLUDE_FROM_REFRESH = {
    "노출있음": "최근 7일 노출 > 0",
    "유입있음": "최근 7일 유입 > 0",
    "전환있음": "최근 7일 주문 > 0"
}
```

#### 4.2 삭제금지상품 자동 관리
```python
# 마케팅 데이터 기반 삭제금지상품 추가 조건 (OR)
PROTECT_CONDITIONS = {
    "노출": "최근 7일 노출 2회 이상",
    "유입": "최근 7일 유입 1회 이상",
    "전환": "최근 7일 주문 1회 이상"
}

# 데이터 소스
# - 마케팅 시트: https://docs.google.com/spreadsheets/d/14l6Y7y7bHcn6LRGlfQ0QOKHNGWI5tFqPWRioxE8aoTo
# - 각 스토어명 탭에서 판매자코드 추출
# - 삭제금지상품 탭에 자동 추가

# 정리 조건
# - 삭제금지상품 탭에서 한번도 매칭 안 된 판매자코드 → 삭제
```

#### 4.3 물갈이 자동화 프로세스
```python
# 물갈이 프로세스
REFRESH_PROCESS = """
1. 기존 상품 비노출 처리 (삭제 아님!)
2. 상품명 키워드 최신화
3. 상세페이지 20-30% 리프레시 (일부 이미지 교체)
4. 가격/옵션 재정비
5. 신규 등록 (최신성 점수 획득)
6. 쿠폰 발급
"""
```

---

### 🟢 Phase 5: 광고 자동화

#### 5.1 광고 자동 등록 (별도 개발 중)
```python
# 현재 별도 프로젝트로 SA광고 자동화 개발 중
# 통합관리 시스템과 연동 필요

# 핵심 기능
- 상품번호 기반 소재 자동 등록
- 그룹 자동 분배 (1,000개 단위)
- 입찰가 자동 조정 (70원~200원)
```

#### 5.2 광고 효율 분석
```python
# 쇼핑파트너센터 상품클릭리포트 데이터 활용
ADVERTISING_METRICS = {
    "노출수": "상품별 노출 횟수",
    "클릭수": "상품별 클릭 횟수", 
    "클릭률": "클릭수/노출수",
    "CPC수수료": "클릭당 비용"
}

# 자동 조정 로직
- 노출 0 + 7일 경과 → 입찰가 상향
- 클릭률 0.5% 미만 → 썸네일/상품명 개선 알림
- 전환 없이 광고비만 지출 → OFF 권고
```

---

## 🔷 데이터 흐름도

```
┌─────────────────────────────────────────────────────────────────┐
│                    구매대행 통합관리 시스템                        │
├─────────────────────────────────────────────────────────────────┤
│                                                                 │
│  [데이터 수집]                                                   │
│  ├── 비즈어드바이저 → 상품노출성과 (노출순위/유입수)              │
│  ├── 쇼핑파트너센터 → 상품클릭리포트 (클릭/전환/CPC)             │
│  ├── Commerce API → 매출/주문 데이터                            │
│  └── 클린위반현황 → 위반 리스트                                  │
│                         ↓                                       │
│  [분석/판단]                                                     │
│  ├── 물갈이 필요 상품 판별                                       │
│  ├── 효자상품/저성과상품 분류                                    │
│  ├── 광고 효율 분석                                             │
│  └── 클린위반 리스크 판단                                        │
│                         ↓                                       │
│  [자동 실행]                                                     │
│  ├── 물갈이 알림 → (수동 승인) → 재업로드                        │
│  ├── 쿠폰 자동 발급                                             │
│  ├── 클린위반 알림                                              │
│  └── 광고 입찰가 조정                                           │
│                         ↓                                       │
│  [리포트]                                                        │
│  ├── 일일 매출 리포트 (기존)                                     │
│  ├── 상품 성과 대시보드 (신규)                                   │
│  ├── 물갈이 현황 리포트 (신규)                                   │
│  └── 클린위반 현황 리포트 (신규)                                 │
│                                                                 │
└─────────────────────────────────────────────────────────────────┘
```

---

## 🔷 구현 우선순위 요약

| 순서 | 기능 | 현재 상태 | 난이도 |
|------|------|----------|--------|
| 1 | 마케팅분석 데이터 수집 완성 | 🔄 진행중 | 중 |
| 2 | 물갈이 알림 시스템 | ⬜ 미구현 | 중 |
| 3 | 쿠폰 자동 발급 | ⬜ 미구현 | 하 |
| 4 | 클린위반 모니터링 | ⬜ 미구현 | 중 |
| 5 | 삭제 대상 자동 선정 | ⬜ 미구현 | 중 |
| 6 | 물갈이 자동화 | ⬜ 미구현 | 상 |
| 7 | 광고 연동 | 🔄 별도 개발 | 상 |

---

## 🔷 핵심 성공 포인트 (교육 자료 기반)

1. **데이터 기반 의사결정**: 감이 아닌 유입수/클릭수 데이터로 물갈이/광고 판단
2. **소수 집중 전략**: 닥등(대량등록) 대신 효자상품 발굴에 집중
3. **최신성 관리**: 주기적 물갈이로 노출 유지 (평균 2개월)
4. **클린 관리 철저**: 24주 이력 유지, 주차 내 즉시 대응
5. **전환율 최적화**: 쿠폰(전환장치) + 찜(재노출자산) + 리뷰 복합 운영

---

*작성일: 2026-01-15*
*용도: 클로드코드 작업 참고용*
